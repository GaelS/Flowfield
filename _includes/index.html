<html>

<head>

  <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">

</head>

<body style="font-family: 'Inconsolata', monospace" ;>

  <div id="app" style></div>
</body>

</html>
<script src='https://cdnjs.cloudflare.com/ajax/libs/react/16.0.0/umd/react.production.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.0.0/umd/react-dom.production.min.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>
<script src='../dist/bundle.js'></script>
<script type="text/babel">
  function init(w, h){
    let FF = FlowField.default(1, h,w); 
    FF.setTarget([4, 6]); 
    FF.updateDistance(); 
    FF.updateVectorField();
    return FF;
  }
  
  class App extends React.Component{ 
    state={mode: 0, width: 10, height: 10, FF: null}
    componentDidMount(){
      this.setState({FF : init(this.state.height,this.state.width) });
    }
    switchMode=() => {
      this.setState({mode: !this.state.mode ? 1: 0});
    }
    updateWidth = (e) => this.setState({width: parseInt(e.target.value,10)}, () => this.setState({FF: init(this.state.height, this.state.width)}))
    updateHeight = (e) => this.setState({height: parseInt(e.target.value,10)}, () => this.setState({FF: init(this.state.height, this.state.width)}))
    
    onCellClick(target){
      const cell = this.state.FF.getCell(target);

      if(cell.distance > 0){ this.state.FF.setObstacle(target); } 
      if(cell.distance === -1){ this.state.FF.setTarget(target); } 
      this.state.FF.updateDistance();
      this.state.FF.updateVectorField();
      this.forceUpdate();
    }
    render(){ 
      if(!this.state.FF){
        return <div>On going...</div>;
      }
      return ( 
        [<div style={{textAlign:'center', fontSize: '25px', marginBottom: '30px', textDecoration: 'underline'}}>Do you feel the flowfield ?? </div>,
        <div style={{display:'flex', justifyContent:'center'}}>
        <div style={{
          marginTop: '200px'}}>
          <p>Width</p>
          <input  onChange={this.updateWidth} type="range" min="0" max="30" placeholder="width" value={this.state.width}/>
          <p>Height</p>
          <input onChange={this.updateHeight} type="range" min="0" max="30" value={this.state.height}/>
          <div><button style={{font: 'inherit', marginTop: '10px',padding: '8px',cursor: 'pointer', backgroundColor: '#ffcccc'}} onClick={this.switchMode}>Switch Mode</button></div>
        </div>
          <table>{this.state.FF.getGrid().map((row,i) =>
          <tr>{row.map((cell,j) => 
            <td style={{width: '50px',textAlign: 'center', cursor: 'pointer', height: '50px', backgroundColor: cell.obstacle ? 'black'
              : cell.distance===0 ? '#cfc' : '#e9e0e0'}} 
              onClick={()=>this.onCellClick([i,j])}>
                {this.state.mode ? String.fromCharCode(parseInt(getArrow(cell.direction, cell.obstacle), 10)) : cell.distance}
            </td>)}
          </tr>)}
        </table>
        </div>])
    }
  }; 
    function getArrow(direction, obstacle){
      if(!direction || direction.length === 0) {
        return '0';
      }
      if(obstacle){
        return '88';
      }
      //bottom
        if(direction[0] === 1 && direction[1] === 0){
          return "8595"
        }//right
        else if(direction[0] === 0 && direction[1] === 1){
          return "8594"
        }//left
        else if(direction[0] === 0 && direction[1] === -1){
          return "8592"
        }//top
        else if(direction[0] === -1 && direction[1] === 0){
          return "8593"
        }//bottom right
        else if(direction[0] === 1 && direction[1] === 1){
          return "8600"
        }//bottom left
        else if(direction[0] === 1 && direction[1] === -1){
          return "8601"
        }//top left
        else if(direction[0] === -1 && direction[1] === -1){
          return "8598"
        }//top right
        else if(direction[0] === -1 && direction[1] === 1){
          return "8599"
      }
      return '33';
    }
    ReactDOM.render( <App/>, document.getElementById('app'));
</script>